### 5. Мониторинг и статистика

#### Challenge

В этом задании мы апгрейдим ваш стенд, в качестве дагов можно написать какие-то новые или использовать любые
два пайплайна из предыдущих заданий.

1. Установите на свой сервер графану, закройте её с помощью nginx через **тот же** basic auth.
   Пусть графана отвечает по порту 3333
1. Добавьте дашборд с мониторингом ваших дагов. На дашборде должны присутствовать больше одного дага.
1. Добавьте пайплайн-канарейку, опционально проверяющий доступность какого-то источника.
   Отобразите здоровье канарейки на дашборде.
1. Для мониторинга состояния самого airflow поставьте [airflow-exporter](https://github.com/epoch8/airflow-exporter).
1. Один из ваших пайплайнов должен использовать `on_failure_callback` (пинг в телеграм).
1. Один таск в одном из ваших пайплайнов должен приводить к тому что пайплайн _примерно_
   каждый пятый запуск будет делать SLA miss.

Дополнительные требования:

- На дашборде всё может быть максимально захардкожено, не надо мудрить;
- Технические метрики дагов выбирайте на ваше усмотрение, но можно просто дать те что есть.
  Обычно интересует следующее: количество запусков за какой-то период, time since последний запуск,
  время выполнения отдельных критичных тасок.
  Соберите на дашборде метрики, помогающие ответить на эти вопросы;
- На пайплайн-канарейку добавьте `sla_miss_callback` и `on_failure_callback`;
- Сделайте **максимум** два дашборда (можно один);
- В графану так просто данные не польются, вам нужен локальный prometheus на той же машине.
  Его можно не вытаскивать наружу, но для дебага удобно;
- (Опционально) добавьте в микс statsd и используйте его для отправки бизнес-метрик из ваших пайплайнов.
  Это может быть число строчек в базе, количество грязи в данных, число отправленных tg-сообщений
  или какая-то ещё _контекстно-релевантная_ метрика для пайплайна.
  
 ***
  
##### Решение
  
1. Grafana в упор отказывалась реагировать на изменение в конфиге. Убил кучу времени, пока это понял.
Поэтому в домашке она на стандартном своем порту и не умеет ничего крутого,
 типа проброса Nginx авторизации. Но штука интересная. Надо с ней еще поразбираться.
1. DAG: hw05. Ничего особенного. Канарейка умеет иногда вылетать за SLA, а когда не доступна БД,
которую она мониторит - эта самая канарейка умеет красиво сдохнуть и корректно тригернуть on_failure_callback.
1. Дешборд один. Мониторит и канарейку отдельно, и даги/таски вцелом.