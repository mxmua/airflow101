### 3. Собственные <s>вектора </s> операторы и сенсоры; самодельные внешние пакеты

#### Challenge

1. Сделать DAG из трёх шагов, использующий telegram bot API.
1. Бот публикует сообщение в групповой чат с кнопкой "Поехали" под сообщением.
   Вас добавят в группу. Токен будет в чате.
1. Сенсор в пайплайне ждёт когда кто-то нажмёт на кнопку под сообщением в телеге.
   Группа и бот общий для всех, так что не стесняйтесь помогать
   тестировать друг другу.
1. Распарсите **нужный** апдейт от бота. Сохраните метаданные
   в таблицу в airtable.
   [Документация по доступам](img/w3-airtable-access.png)
   (картинка, 4 Mb).
1. Вы можете сделать DAG без расписания и триггерить его руками из админки.

Технические (и не очень) тонкости:

- Бот, токен и группа где этот бот есть &mdash; получить у оргов;
- Можно использовать какую-то библиотеку но в целом здесь
  хватит грамотного использования `requests`, так как вам
  не требуется сложного взаимодействия с пользователем.
  [Заготовка такого класса для бота](snippets/w3-example-tg-bot-class.py);
- Для сохранения какой-то промежуточной информации используйте временный файл на диске;
- Для тестирования можно создать свою airtable базу/таблицу;
- Бот и группа общие для всех. Создавать отдельного бота чтобы отладить как это работает мы не рекомендуем:
  возможные незначительные технические трудности с доступами могут надолго отвлечь от задачи;
- Финальный датасет содержит следующие колонки:
  `chat_id`,
  `username`,
  `triggered_at`,
  `event_type`,
  `reporter_name`.
  Их типы можно подсмотреть прямо в таблице;
- Подразумевается, что вы будете использовать самодельные операторы/сенсоры и опубликуете их как библиотеку на github;
- В данном задании можно захардкодить токен для доступа прям в коде вашего пайплайна.
  Если вы решите так сделать, то не выкладывайте код в публичный репозиторий.

*** 
#### Решение
Работает.

DAG в этом репозитории. Вынесенная в отдельный пакет начинка -
в соседнем: https://github.com/mxmua/airflow101-hw03-operators.

`pip install git+ssh://git@github.com/mxmua/airflow101-hw03-operators.git`

Credentials Telegram и Airtable пока просто спрятал в отдельный файл, который не заливается в git.

Сейчас бот не прячет кнопку и в таблицу попадает первое нажатие на момент проверки апдейтов.
Нашел, как прятать клавиатуру после нажатия кнопки, но очень уж спать хотелось).
+Это довольно неудобно реализовывать в режиме long pooling. Если б знал, что успею - пробовал бы через веб-хук.

*P.S. навсякий случай: venv больше не используется на сервере. Активировать не нужно.*